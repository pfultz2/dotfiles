#!/bin/bash
SOURCE=$HOME
BACKUP=`hostname`
HOST=backup

if [ "$#" -ne 1 ]; then
    SRC=`pwd`
else
    SRC=`realpath $1`
fi
TOP_DIR=`dirname $SOURCE`
DEST=`echo $SRC | sed -e "s,$TOP_DIR,,"`

if [ -d "${SRC}" ] ; then
    comm -23 <(ssh $HOST "find ~/backup/$BACKUP/backup-*/$DEST -maxdepth 1 -type f -print0 | xargs -0 -n1 basename | sort -u") <(ls -1 $SRC | sort)
else
    ssh $HOST "ls -1 ~/backup/$BACKUP | xargs -I{} ls -i ~/backup/$BACKUP/{}$DEST 2>/dev/null | sort -u -k 1,1 | cut -f 2 -d' '"
fi
